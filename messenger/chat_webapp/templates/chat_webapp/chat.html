{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Чат</title>
</head>
<body>
<h1>Чат</h1>
<p>Привет, {{ user }}!</p>

<h2>Сообщения</h2>
<ul>
    {% for msg in messages %}
        <li>
            {% if msg.user == user %}
                <strong>Вы:</strong> {{ msg.content }}

                <!-- Редактировать -->
                <form method="post" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" name="edit_message_id" value="{{ messages }}">Редактировать</button>
                </form>

                <!-- Удалить -->
                <form method="post" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" name="delete_message" value="{{ message }}">Удалить</button>
                </form>
            {% else %}
                <strong>{{ msg.user.username }}:</strong> {{ msg.content }}
            {% endif %}

            {% if request.POST.edit_message_id|stringformat:"s" == msg.id|stringformat:"s" %}
                <!-- Форма редактирования -->
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="edit_message_id" value="{{ msg.id }}">
                    <input type="text" name="content" value="{{ msg.content }}">
                    <button type="submit">Сохранить</button>
                </form>
            {% endif %}
        </li>
    {% empty %}
        <li>Сообщений пока нет.</li>
    {% endfor %}
</ul>

<h2>Отправить новое сообщение</h2>
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Отправить</button>
</form>

</body>
</html>
